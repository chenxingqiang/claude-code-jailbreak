# ğŸ§  æ™ºèƒ½Tokenç®¡ç†ç³»ç»Ÿç”¨æˆ·æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

Claude LLM Gatewayç°åœ¨å…·å¤‡äº†æ™ºèƒ½Tokenç®¡ç†åŠŸèƒ½ï¼Œ**è§£å†³äº†ä¸åŒLLMæä¾›å•†tokené™åˆ¶ä¸ç»Ÿä¸€çš„é—®é¢˜**ã€‚Claude Codeå¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„`max_tokens`å‚æ•°ï¼Œè€Œåå°ç½‘å…³ä¼šæ ¹æ®ç›®æ ‡APIæä¾›å•†çš„å…·ä½“é™åˆ¶è‡ªåŠ¨è°ƒæ•´åˆ°æœ€ä½³å€¼ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. **ç»Ÿä¸€æ¥å£ï¼Œæ™ºèƒ½é€‚é…**
- Claude Codeä½¿ç”¨æ ‡å‡†çš„`max_tokens`å‚æ•°
- åå°è‡ªåŠ¨æ ¹æ®æä¾›å•†é™åˆ¶è°ƒæ•´
- å®Œå…¨é€æ˜ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 

### 2. **ä»»åŠ¡ç±»å‹æ™ºèƒ½æ£€æµ‹**
- **ç¼–ç¨‹ä»»åŠ¡** â†’ è‡ªåŠ¨é€‰æ‹©ç¼–ç¨‹ä¸“ç”¨æ¨¡å‹ + ä¼˜åŒ–tokenåˆ†é…
- **å¯¹è¯ä»»åŠ¡** â†’ é€‰æ‹©å¯¹è¯ä¼˜åŒ–æ¨¡å‹ + é€‚ä¸­tokenåˆ†é…  
- **åˆ†æä»»åŠ¡** â†’ æ ¹æ®å¤æ‚åº¦åŠ¨æ€è°ƒæ•´
- **åˆ›ä½œä»»åŠ¡** â†’ åˆ†é…æ›´å¤štokensæ”¯æŒåˆ›æ„è¾“å‡º
- **ç¿»è¯‘ä»»åŠ¡** â†’ ä¼˜åŒ–å¤šè¯­è¨€å¤„ç†æ•ˆç‡

### 3. **å¤šç»´åº¦ä¼˜åŒ–ç­–ç•¥**
- **æˆæœ¬ä¼˜å…ˆ** â†’ é€‰æ‹©æˆæœ¬æœ€ä½çš„æœ‰æ•ˆé…ç½®
- **è´¨é‡ä¼˜å…ˆ** â†’ ç¡®ä¿è¾“å‡ºè´¨é‡ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰
- **é€Ÿåº¦ä¼˜å…ˆ** â†’ ä¼˜åŒ–å“åº”æ—¶é—´
- **æ™ºèƒ½å¹³è¡¡** â†’ ç»¼åˆè€ƒè™‘å„é¡¹å› ç´ 

## ğŸ”§ æä¾›å•†Tokené™åˆ¶

### ä¸»è¦æä¾›å•†é™åˆ¶ä¸€è§ˆ

| æä¾›å•† | æ¨¡å‹ | æœ€å°å€¼ | æœ€å¤§å€¼ | æœ€ä¼˜å€¼ | æˆæœ¬/1K |
|--------|------|--------|--------|--------|---------|
| **OpenAI** | gpt-4 | 1 | 8,192 | 4,096 | $0.030 |
| | gpt-4-turbo | 1 | 128,000 | 8,192 | $0.010 |
| | gpt-3.5-turbo | 1 | 4,096 | 2,048 | $0.002 |
| **DeepSeek** | deepseek-chat | 1 | 8,192 | 4,096 | $0.0014 |
| | deepseek-coder | 1 | 8,192 | 4,096 | $0.0014 |
| **Anthropic** | claude-3-opus | 1 | 4,096 | 2,048 | $0.075 |
| | claude-3-sonnet | 1 | 4,096 | 2,048 | $0.015 |
| | claude-3-haiku | 1 | 4,096 | 2,048 | $0.00125 |
| **Google** | gemini-pro | 1 | 8,192 | 4,096 | $0.0005 |
| | gemini-1.5-pro | 1 | 32,768 | 8,192 | $0.0035 |
| **Groq** | mixtral-8x7b | 1 | 32,768 | 8,192 | $0.00027 |
| **Cohere** | command-r-plus | 1 | 128,000 | 8,192 | $0.003 |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. **Claude Codeæ­£å¸¸ä½¿ç”¨**
```bash
# æ— éœ€ä»»ä½•ä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨åŸæœ‰æ–¹å¼
claude --print "å†™ä¸€ä¸ªPythonçˆ¬è™«ç¨‹åº"

# ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
# âœ… æ£€æµ‹è¿™æ˜¯ç¼–ç¨‹ä»»åŠ¡
# âœ… é€‰æ‹©deepseek-coderæ¨¡å‹  
# âœ… ä¼˜åŒ–tokenåˆ†é…ç­–ç•¥
# âœ… é€‚é…DeepSeekçš„8192é™åˆ¶
```

### 2. **APIç›´æ¥è°ƒç”¨**
```bash
curl -X POST http://localhost:8765/v1/messages \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-3-sonnet-20240229",
    "max_tokens": 6000,  // ç»Ÿä¸€å‚æ•°
    "messages": [...],
    "prioritize_quality": true  // å¯é€‰ï¼šä¼˜å…ˆè´¨é‡
  }'

# åå°è‡ªåŠ¨å¤„ç†ï¼š
# ğŸ“Š åŸå§‹è¯·æ±‚: 6000 tokens
# ğŸ§  æ™ºèƒ½åˆ†æ: ç¼–ç¨‹ä»»åŠ¡ï¼Œé€‰æ‹©deepseek-coder
# âš–ï¸  é€‚é…é™åˆ¶: 6000 â†’ 4000 (DeepSeekæœ€ä¼˜å€¼)
# ğŸ“ˆ ç­–ç•¥: quality-focused
```

## ğŸ“Š æ™ºèƒ½åˆ†é…ç¤ºä¾‹

### ç¼–ç¨‹ä»»åŠ¡
```
è¾“å…¥: "å†™ä¸€ä¸ªå®Œæ•´çš„Reactç»„ä»¶"
åŸå§‹max_tokens: 3000

ğŸ§  ä»»åŠ¡æ£€æµ‹: ç¼–ç¨‹ä»»åŠ¡ (ç½®ä¿¡åº¦: 95%)
ğŸ¯ æ¨¡å‹é€‰æ‹©: deepseek-coder
âš–ï¸  Tokenè°ƒæ•´: 3000 â†’ 4000 (ç¼–ç¨‹ä»»åŠ¡éœ€è¦æ›´å¤šè¾“å‡º)
ğŸ’° æˆæœ¬ä¼°ç®—: $0.0056
âœ… åˆ†é…ç­–ç•¥: quality-focused
```

### å¯¹è¯ä»»åŠ¡  
```
è¾“å…¥: "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
åŸå§‹max_tokens: 2000

ğŸ§  ä»»åŠ¡æ£€æµ‹: å¯¹è¯ä»»åŠ¡ (ç½®ä¿¡åº¦: 100%)
ğŸ¯ æ¨¡å‹é€‰æ‹©: deepseek-chat  
âš–ï¸  Tokenè°ƒæ•´: 2000 â†’ 1024 (å¯¹è¯ä»»åŠ¡ä¼˜åŒ–)
ğŸ’° æˆæœ¬ä¼°ç®—: $0.0014
âœ… åˆ†é…ç­–ç•¥: cost-optimized
```

### åˆ†æä»»åŠ¡
```
è¾“å…¥: "åˆ†æè¿™æ®µä»£ç çš„æ€§èƒ½ç“¶é¢ˆ"
åŸå§‹max_tokens: 4000

ğŸ§  ä»»åŠ¡æ£€æµ‹: åˆ†æä»»åŠ¡ (ç½®ä¿¡åº¦: 85%)
ğŸ¯ æ¨¡å‹é€‰æ‹©: claude-3-sonnet
âš–ï¸  Tokenè°ƒæ•´: 4000 â†’ 4000 (ä¿æŒåŸå€¼)
ğŸ’° æˆæœ¬ä¼°ç®—: $0.060
âœ… åˆ†é…ç­–ç•¥: balanced
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### 1. **Tokenç»Ÿè®¡API**
```bash
curl http://localhost:8765/tokens/stats
```
```json
{
  "success": true,
  "stats": {
    "totalProviders": 9,
    "supportedTaskTypes": ["coding", "conversation", "analysis", "creative", "translation", "summary"],
    "averageOptimalTokens": 3863,
    "costRange": { "min": 0.0001, "max": 0.075, "median": 0.002 }
  }
}
```

### 2. **æä¾›å•†é™åˆ¶æŸ¥è¯¢**
```bash
curl "http://localhost:8765/tokens/limits?provider=deepseek"
```
```json
{
  "success": true,
  "provider": "deepseek", 
  "limits": {
    "deepseek-chat": { "min": 1, "max": 8192, "optimal": 4096, "cost_per_1k": 0.0014 },
    "deepseek-coder": { "min": 1, "max": 8192, "optimal": 4096, "cost_per_1k": 0.0014 }
  }
}
```

### 3. **Tokenä¼°ç®—**
```bash
curl -X POST http://localhost:8765/tokens/estimate \
  -H "Content-Type: application/json" \
  -d '{"text": "å†™ä¸€ä¸ªPythonå‡½æ•°", "provider": "deepseek", "model": "deepseek-coder"}'
```
```json
{
  "success": true,
  "estimatedTokens": 8,
  "textLength": 8,
  "limits": { "min": 1, "max": 8192, "optimal": 4096, "cost_per_1k": 0.0014 },
  "recommendations": {
    "conservative": 16,
    "recommended": 24,
    "generous": 32
  }
}
```

### 4. **è¯¦ç»†åˆ†ææŠ¥å‘Š**
```bash
curl -X POST http://localhost:8765/tokens/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "claudeRequest": {
      "max_tokens": 4000,
      "messages": [{"role": "user", "content": "å†™ä»£ç "}]
    },
    "provider": "deepseek",
    "model": "deepseek-coder", 
    "taskType": "coding"
  }'
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. **ä»»åŠ¡ç±»å‹åŒ¹é…**
- âœ… **ç¼–ç¨‹ä»»åŠ¡** â†’ ä½¿ç”¨å¸¦"coder"çš„æ¨¡å‹
- âœ… **å¯¹è¯ä»»åŠ¡** â†’ ä½¿ç”¨å¯¹è¯ä¼˜åŒ–æ¨¡å‹
- âœ… **åˆ†æä»»åŠ¡** â†’ é€‰æ‹©æ¨ç†èƒ½åŠ›å¼ºçš„æ¨¡å‹
- âœ… **åˆ›ä½œä»»åŠ¡** â†’ åˆ†é…å……è¶³çš„tokené¢åº¦

### 2. **æˆæœ¬æ§åˆ¶**
- ğŸ’° **é¢„ç®—æœ‰é™** â†’ è®¾ç½®`prioritize_cost: true`
- ğŸ¯ **è´¨é‡è¦æ±‚é«˜** â†’ è®¾ç½®`prioritize_quality: true`
- âš¡ **é€Ÿåº¦è¦æ±‚å¿«** â†’ è®¾ç½®`prioritize_speed: true`

### 3. **æœ€ä½³å®è·µ**
```javascript
// åœ¨Claude APIè¯·æ±‚ä¸­æ·»åŠ ä¼˜åŒ–å‚æ•°
{
  "model": "claude-3-sonnet-20240229",
  "max_tokens": 4000,
  "messages": [...],
  
  // æ™ºèƒ½ä¼˜åŒ–å‚æ•°ï¼ˆå¯é€‰ï¼‰
  "prioritize_cost": false,      // æˆæœ¬ä¼˜å…ˆ
  "prioritize_quality": true,    // è´¨é‡ä¼˜å…ˆï¼ˆæ¨èï¼‰
  "prioritize_speed": false      // é€Ÿåº¦ä¼˜å…ˆ
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. **Tokenåˆ†é…å¼‚å¸¸**
```
ç—‡çŠ¶: Tokenåˆ†é…ä¸åˆç†
è§£å†³: æ£€æŸ¥ä»»åŠ¡ç±»å‹æ£€æµ‹æ˜¯å¦å‡†ç¡®
è°ƒè¯•: GET /tokens/analyze æŸ¥çœ‹è¯¦ç»†åˆ†æ
```

#### 2. **æˆæœ¬è¶…å‡ºé¢„æœŸ**
```
ç—‡çŠ¶: APIè°ƒç”¨æˆæœ¬è¿‡é«˜
è§£å†³: å¯ç”¨æˆæœ¬ä¼˜å…ˆæ¨¡å¼
é…ç½®: "prioritize_cost": true
```

#### 3. **è¾“å‡ºè´¨é‡ä¸ä½³**
```
ç—‡çŠ¶: ç”Ÿæˆå†…å®¹è´¨é‡ä¸‹é™
è§£å†³: å¯ç”¨è´¨é‡ä¼˜å…ˆæ¨¡å¼
é…ç½®: "prioritize_quality": true
```

#### 4. **å“åº”é€Ÿåº¦æ…¢**
```
ç—‡çŠ¶: APIå“åº”æ—¶é—´è¿‡é•¿
è§£å†³: å¯ç”¨é€Ÿåº¦ä¼˜å…ˆæ¨¡å¼ + é€‰æ‹©å¿«é€Ÿæ¨¡å‹
é…ç½®: "prioritize_speed": true
```

## ğŸ‰ å®é™…æ•ˆæœéªŒè¯

åŸºäºå®é™…æµ‹è¯•ï¼Œæ™ºèƒ½Tokenç®¡ç†ç³»ç»Ÿå·²ç»å®ç°ï¼š

### âœ… **æˆåŠŸæ¡ˆä¾‹**
1. **ç¼–ç¨‹ä»»åŠ¡è‡ªåŠ¨æ£€æµ‹** â†’ `deepseek-coder` (ç½®ä¿¡åº¦100%)
2. **Tokenæ™ºèƒ½è°ƒæ•´** â†’ 4000â†’4000 quality-focusedç­–ç•¥
3. **APIé™åˆ¶é€‚é…** â†’ è‡ªåŠ¨ç¬¦åˆDeepSeek 1-8192é™åˆ¶
4. **æˆæœ¬æ•ˆç›Šä¼˜åŒ–** â†’ é€‰æ‹©æœ€ç»æµçš„é«˜è´¨é‡æ–¹æ¡ˆ

### ğŸ“Š **ç›‘æ§æ•°æ®**
- æ”¯æŒ9ä¸ªä¸»è¦LLMæä¾›å•†
- è¯†åˆ«6ç§ä»»åŠ¡ç±»å‹
- å¹³å‡æœ€ä¼˜Tokenå€¼: 3863
- æˆæœ¬èŒƒå›´: $0.0001-$0.075/1K tokens

---

**ğŸŠ ç°åœ¨ä½ çš„Claude Codeæ‹¥æœ‰äº†çœŸæ­£æ™ºèƒ½çš„Tokenç®¡ç†ç³»ç»Ÿï¼**
- ğŸ”„ **ç»Ÿä¸€æ¥å£** - æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- ğŸ§  **æ™ºèƒ½é€‚é…** - è‡ªåŠ¨ä¼˜åŒ–tokenåˆ†é…
- ğŸ’° **æˆæœ¬æ§åˆ¶** - å¹³è¡¡è´¨é‡ä¸æˆæœ¬
- ğŸ“Š **é€æ˜ç›‘æ§** - å®Œæ•´çš„åˆ†æå’Œè°ƒè¯•å·¥å…·
